#!/usr/bin/env -S flatpak-builder --user --install --force-clean tmp

app-id: dev.boxi.Boxi
runtime: org.gnome.Platform
runtime-version: '42'
sdk: org.gnome.Sdk

modules:
  - name: vte
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/vte.git/
        tag: 0.69.99
        commit: 768acd1c0a8bd11b9b9fc2be78d8a3159ecef32b
    buildsystem: meson
    config-opts:
      - -Dgtk3=false
      - -Dgtk4=true

  - name: python3-flit_core
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/ad/38/80992c4cb490a05474c886850ec818276d09c0a6722bd5b43bc487818ac7/flit_core-3.7.1-py3-none-any.whl
        sha256: e454fdbf68c7036e1c7435ec7479383f9d9a1650ca5b304feb184eba1efcdcef
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation --prefix=/app flit_core-3.7.1-py3-none-any.whl

  - name: boxi
    sources:
      - type: git
        url: .
        branch: HEAD
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation --prefix=/app .
      - glib-compile-schemas --strict /app/share/glib-2.0/schemas

command: boxi

cleanup:
  - '/bin/vte-2.91-gtk4'
  - '/etc'
  - '/include'
  - '/lib/debug'
  - '/lib/libvte-2.91-gtk4.so'
  - '/lib/pkgconfig'
  - '/lib/python3.*/site-packages/flit_core*'
  - '/lib/systemd'
  - '/libexec'
  - '/share/gir-1.0'
  - '/share/glade'
  - '/share/vala'

finish-args:
  - --talk-name=org.freedesktop.Flatpak
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri
  - --share=ipc
